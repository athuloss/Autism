<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CSRF Token -->
    <meta name="csrf-token" content="{{ csrf_token }}" />

    <!-- jQuery CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
      body {
        font-family: "Poppins", serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        color: #212529;
      }

      .sidebar {
        width: 220px;
        background-color: #212529;
        color: #f8f9fa;
        position: fixed;
        height: 100vh;
        padding: 15px 0;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }
      .sidebar a {
        display: block;
        justify-content: center;
        color: #f8f9fa;
        text-decoration: none;
        padding: 10px 65px;
        margin: 8px 0;
        border-radius: 3px;
        transition: background-color 0.3s ease;
      }
      .sidebar a:hover {
        background-color: #343a40;
      }
      .sidebar h2 {
        text-align: center;
        margin-bottom: 15px;
        font-size: 1.4em;
      }
      .dash_head a {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 10px;
      }

      .content {
        margin-left: 220px;
        padding: 15px;
      }
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #ffffff;
        padding: 10px 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .topbar h1 {
        margin: 0;
        font-size: 20px;
        color: #212529;
      }
      .stats {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
      }
      .stat-card {
        justify-content: space-between;
        /* padding: 100px  80px; */
        flex: 1;
        margin: 0 5px;
        padding: 15px;
        background-color: #ffffff;
        color: #212529;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
        display: flex;
        /* flex-direction: column; */
        align-items: center;
        transition: transform 0.2s;
      }
      .stat-card:hover {
        transform: scale(1.02);
      }
      .stat-card h3 {
        margin: 5px 0;
        font-size: 16px;
      }
      .stat-card p {
        font-size: 20px;
        margin: 0;
      }
      .stat-card {
        font-size: 28px;
        margin-bottom: 5px;
      }
      .charts {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
      }
      .chart-container {
        flex: 1;
        margin: 0 5px;
        background-color: #ffffff;
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        height: auto; /* Reduced height */
      }
      .recent-orders {
        margin-top: 15px;
        background-color: #ffffff;
        padding: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
        background-color: #ffffff;
        border-radius: 5px;
        overflow: hidden;
      }
      table th,
      table td {
        text-align: left;
        padding: 12px;
        border-bottom: 1px solid #e9ecef;
      }
      table th {
        background-color: #f1f3f5;
        font-weight: bold;
        color: #495057;
      }
      table td {
        background-color: #ffffff;
        color: #6c757d;
      }
      table tr:hover td {
        background-color: #f8f9fa;
      }
      .action-buttons {
        display: flex;
        gap: 8px;
      }
      .action-buttons a {
        text-decoration: none;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }
      .action-buttons .view {
        background-color: #51cf66;
        color: #ffffff;
      }
      .action-buttons .view:hover {
        background-color: #40c057;
      }
      .action-buttons .edit {
        background-color: #339af0;
        color: #ffffff;
      }
      .action-buttons .edit:hover {
        background-color: #228be6;
      }
      .line-chart-container {
        flex: 1;
        margin: 0 5px;
        background-color: #ffffff;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        height: 200px; /* Matching height for consistency */
      }

      #blogUploadContainer {
        max-width: 500px;
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      #blogUploadContainer h2 {
        margin-top: 0;
        text-align: center;
      }
      #blogUploadContainer label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      #blogUploadContainer input[type="text"],
      #blogUploadContainer textarea,
      #blogUploadContainer input[type="file"] {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 3px;
        box-sizing: border-box;
      }
      #blogUploadContainer button {
        width: 100%;
        padding: 10px;
        background-color: #258ea6;
        color: #fff;
        border: none;
        border-radius: 3px;
        font-size: 16px;
        cursor: pointer;
      }
      #blogUploadContainer button:hover {
        background-color: #357ae8;
      }
      .uploadingwrapper {
        top: 0;
        position: absolute;
        height: 100vh;
        width: 100%;
        backdrop-filter: blur(5px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }
      .closebtn {
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
      }

      .icon_circle {
        align-items: center;
        display: flex;
        justify-content: center;
        /* position: absolute; */
        /* left: 2px; */
        height: 45px;
        width: 45px;
        border-radius: 50%;
        background-color: #21252924;
      }

      .charts {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin: 20px;
      }
      .chart-container {
        flex: 1 1 calc(50% - 20px);
        box-sizing: border-box;
        padding: 20px;
        background-color: #f7f7f7;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        max-width: 50%; /* Prevents any chart container from stretching beyond 50% width */
      }

      .chart-container canvas {
        width: 100%;
        height: 100%;
      }

      
.profilewrapper{
    right: 0;
padding: 30px;
background-color: rgb(255, 255, 255);
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
width: 20%;
position: fixed;
 top: 0;
 border-radius: 5px;
 right: -1000px;
 transition: 0.7s;

}

.profilewrapper.active{
  right: 0;
}
.editeduser,.editedemail{
  font-size: inherit;
  font-weight: inherit;
}
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>Dashboard</h2>
      <div class="dash_head">
        <a href="{% url 'home' %}"><ion-icon name="home"></ion-icon>Home</a>
      </div>
      <!-- <div class="dash_head"><a href="#" onclick="clickforum()"><ion-icon name="newspaper"></ion-icon>Blogs</a></div> -->
      <div class="dash_head">
        <a href="{% url 'home' %}#games"><ion-icon name="game-controller"></ion-icon>Games</a>
      </div>
      <div class="dash_head"  onclick="profile()">
        <a ><ion-icon name="person-circle-outline" style="font-size: 20px;"></ion-icon>Profile</a>
      </div>
    </div>

    <div class="content">
      <div class="topbar">
        <h1>Dashboard</h1>
      </div>
      <div class="stats">
        <div class="stat-card" style="background-color: #b53b3f; color: white">
          <div class="test">
            <h3>Math Adventure</h3>
            <p id="game1_count">5</p>
          </div>
          <div class="icon_circle">
            <ion-icon name="game-controller"></ion-icon>
          </div>
        </div>
        <div class="stat-card" style="background-color: #50a2ee; color: white">
          <div class="test">
            <h3>Fruit Finder</h3>
            <p id="game2_count">5</p>
          </div>
          <div class="icon_circle">
            <ion-icon name="game-controller"></ion-icon>
          </div>
        </div>
        <div class="stat-card" style="background-color: #5b2a86; color: white">
          <div class="test">
            <h3>Image Puzzle</h3>
            <p id="game3_count">5</p>
          </div>
          <div class="icon_circle">
            <ion-icon name="game-controller"></ion-icon>
          </div>
        </div>
        <div class="stat-card" style="background-color: #e3879e; color: white">
          <div class="test">
            <h3>Find The Animal</h3>
            <p id="game4_count">5</p>
          </div>
          <div class="icon_circle">
            <ion-icon name="game-controller"></ion-icon>
          </div>
        </div>
      </div>
      <div class="charts" style="display: flex; flex-wrap: wrap; gap: 20px">
        <div class="chart-container" style="flex: 1 1 calc(50% - 20px)">
          <h3>Game Performance Analysis: Bar Chart</h3>
          <canvas id="barChart" width="500" height="300"></canvas>
          <!-- Set width and height here -->
        </div>
        <div class="chart-container" style="flex: 1 1 calc(50% - 20px)">
          <h3>Game Performance Analysis: Line Chart (Math)</h3>
          <canvas id="mathChart" width="500" height="300"></canvas>
        </div>
        <div class="chart-container" style="flex: 1 1 calc(50% - 20px)">
          <h3>Game Performance Analysis: Line Chart (Fruit)</h3>
          <canvas id="fruitChart" width="500" height="300"></canvas>
        </div>
        <div class="chart-container" style="flex: 1 1 calc(50% - 20px)">
          <h3>Game Performance Analysis: Line Chart (Image Puzzle)</h3>
          <canvas id="imageChart" width="500" height="300"></canvas>
        </div>
        <div class="chart-container" style="flex: 1 1 calc(50% - 20px)">
          <h3>Game Performance Analysis: Line Chart (Animal)</h3>
          <canvas id="animalChart" width="500" height="300"></canvas>
        </div>
      </div>
    </div>



<!-- 

<div class="profilewrapper">
  <ion-icon name="person-circle-outline" style="font-size: 65px; align-self: center; display: flex; width: 100%;margin-top: -10px;"></ion-icon>
<h3 style="align-self: center;display: flex;align-items: center;justify-content: center;width: 100%;margin-top: -7px;font-weight: 450;">Profile Details</h3>
  <div class="profilesection" style="display: flex; flex-direction: column;gap: 10px;">
    <div class="headerpart" style="display: flex;justify-content: space-between;">
      <div  style="display: flex;flex-direction: column;">
        <h5 style="margin: 0;font-size: 15px;font-weight: 400;">username</h5>
        <h3 style="font-weight: 500;font-size: 16px;"  class="usernamedata">{{profile.username}}</h3>
      </div>
      <div class="actions">
        <button  class="edit" style=" display: flex;   background-color: rgb(64, 138,98); border-radius:5px;border: none;color: white;font-weight: 500;padding: 7px;" onclick="exchangedata()"><ion-icon name="pencil"></ion-icon></button>
       <div class="btnss1" style="display: flex; gap: 10px;">
         <button class="cancel"   style="  display: none;      background-color: rgb(0, 0, 0); border-radius:5px;border: none;color: white;font-weight: 500;padding: 7px;"><ion-icon name="close"></ion-icon></button>

         <button class="save"  style="  display: none;      background-color: rgb(255, 255, 255); border-radius:5px;border:1px solid black;color: rgb(0, 0, 0);font-weight: 500;padding: 7px;" onclick="updatedata()"><ion-icon name="bookmark"></ion-icon></button>
       </div>
     
      </div>
    </div>
    <div class="emailaddress"  style="display: flex;flex-direction: column;">
      <h5 style="margin: 0;font-size: 15px;font-weight: 400;">email</h5>
      <h3 style="font-weight: 500;font-size: 16px;"  class="emailofthecurrentuser">{{profile.email}}</h3>
    </div>
    <button style="font-weight: 600; color: white; background-color: rgb(64, 138, 98); border: none;padding: 7px;border-radius: 5px;" onclick="resetpasswprd()">Reset Password</button>
    <input type="password"  class="password" id="passed"  placeholder="Enter password" style="padding: 7px;border-radius: 5px; border: 1px solid grey;display: none;">
  </div>

</div> -->






<div class="profilewrapper" style="background: #f8f9fa; padding: 20px; border-radius: 10px; width: 350px; box-shadow: 0px 4px 10px rgba(0,0,0,0.1); text-align: center; margin: auto;">
  
  <ion-icon name="person-circle-outline" style="font-size: 80px; color: #408a62; margin-bottom: 5px;"></ion-icon>
  
  <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #333;">Profile Details</h3>

  <div class="profilesection" style="display: flex; flex-direction: column; gap: 15px; margin-top: 15px;">
    
    <div class="headerpart" style="display: flex; justify-content: space-between; align-items: center; background: white; padding: 10px; border-radius: 8px; box-shadow: 0px 2px 5px rgba(0,0,0,0.1);">
      
      <div style="display: flex; flex-direction: column; text-align: left;">
        <h5 style="margin: 0; font-size: 14px; font-weight: 400; color: #666;">Username</h5>
        <h3 class="usernamedata" style="font-size: 16px; font-weight: 500; color: #333;">{{profile.username}}</h3>
      </div>
      
      <div class="actions" style="display: flex; gap: 8px;">
        <button class="edit" style="background: #408a62; color: white; border: none; border-radius: 5px; padding: 8px 10px; cursor: pointer; display: flex; align-items: center; justify-content: center;" onclick="exchangedata()">
          <ion-icon name="pencil"></ion-icon>
        </button>
        
        <div class="btnss1" style="display: flex; gap: 8px;">
          <button class="cancel" style="display: none; background: black; color: white; border: none; border-radius: 5px; padding: 8px 10px; cursor: pointer;"  onclick="removeinput()">
            <ion-icon name="close"></ion-icon>
          </button>

          <button class="save" style="display: none; background: white; color: black; border: 1px solid black; border-radius: 5px; padding: 8px 10px; cursor: pointer;" onclick="updatedata()">
            <ion-icon name="bookmark"></ion-icon>
          </button>
        </div>
      </div>
    
    </div>

    <div class="emailaddress" style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); text-align: left;">
      <h5 style="margin: 0; font-size: 14px; font-weight: 400; color: #666;">Email</h5>
      <h3 class="emailofthecurrentuser" style="font-size: 16px; font-weight: 500; color: #333;">{{profile.email}}</h3>
    </div>

    <button style="background: #408a62; color: white; font-weight: 600; border: none; padding: 10px; border-radius: 5px; cursor: pointer; transition: 0.3s;" 
      onmouseover="this.style.background='#357b54'" 
      onmouseout="this.style.background='#408a62'" 
      onclick="resetpasswprd()">
      Reset Password
    </button>

    <input type="password" class="password" id="passed" placeholder="Enter password" 
      style="padding: 10px; border-radius: 5px; border: 1px solid grey; display: none; width: 100%; text-align: center; font-size: 14px;">
  
  </div>
</div>






    <script>
      $(document).ready(function () {
        function fetchGameStats() {
          $.ajax({
            url: "{% url 'get_game_stats' %}", // URL from Django
            type: "GET",
            dataType: "json",
            success: function (data) {
              console.log("Data received:", data);

              // Update Stat Cards (Total Games Played)
              $("#game1_count").text(data.Numbergame_count);
              $("#game2_count").text(data.imagepuzzlegame_count);
              $("#game3_count").text(data.imagetile_count);
              $("#game4_count").text(data.animalgame_count);

              // Update Bar Chart (Game Results - Wins & Losses)
              updateBarChart([
                [data.Numbergame_wins, data.Numbergame_losses],
                [data.imagepuzzlegame_wins, data.imagepuzzlegame_losses],
                [data.imagetile_wins, data.imagetile_losses],
                [data.animalgame_wins, data.animalgame_losses],
              ]);

              // Update Line Chart (Time Taken)
              updateLineChart([
                data.Numbergame_time,
                data.imagepuzzlegame_time,
                data.imagetile_time,
                data.animalgame_time,
              ]);
            },
            error: function (xhr, status, error) {
              console.error("Error fetching game stats:", error);
            },
          });
        }

        // Function to Update Bar Chart (Wins & Losses)
        function updateBarChart(resultsData) {
          barChart.data.datasets[0].data = resultsData.map((game) => game[0]); // Wins
          barChart.data.datasets[1].data = resultsData.map((game) => game[1]); // Losses
          barChart.update();
        }

        // Function to Update Line Chart (Time Taken)
        function updateLineChart(timeData) {
          lineChart.data.datasets[0].data = timeData;
          lineChart.update();
        }

        // Fetch data every 5 seconds
        setInterval(fetchGameStats, 5000);
        fetchGameStats(); // Initial call
      });
    </script>

    <script>
      const barCtx = document.getElementById("barChart").getContext("2d");
      const barChart = new Chart(barCtx, {
        type: "bar",
        data: {
          labels: [
            "MathAdventure",
            "Fruit Finder",
            "Image Puzzle",
            "Animal Game",
          ],
          datasets: [
            {
              label: "Wins",
              data: [0, 0, 0, 0], // Wins data (will update dynamically)
              backgroundColor: "rgba(76, 175, 80, 0.8)", // Green
              borderWidth: 1,
            },
            {
              label: "Losses",
              data: [0, 0, 0, 0], // Losses data (will update dynamically)
              backgroundColor: "rgba(244, 67, 54, 0.8)", // Red
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true },
          },
        },
      });

      // const lineCtx = document.getElementById('lineChart').getContext('2d');
      // const lineChart = new Chart(lineCtx, {
      //     type: 'line',
      //     data: {
      //         labels: ['Numbergame', 'Fruit Finder', 'Image Puzzle', 'Animal Game'],
      //         datasets: [{
      //             label: 'Total Time Taken',
      //             data: [0, 0, 0, 0],
      //             backgroundColor: 'rgba(100, 181, 246, 0.2)',
      //             borderColor: '#42a5f5',
      //             borderWidth: 2,
      //             fill: true
      //         }]
      //     },
      //     options: {
      //         responsive: true,
      //         scales: {
      //             y: { beginAtZero: true }
      //         }
      //     }
      // });

      document.addEventListener("DOMContentLoaded", function () {
        fetch("/get_game_stats/") // Calls the Django API
          .then((response) => response.json())
          .then((data) => {
            // Extracting actual time taken for each game
            const numberGameTime = data.Numbergame_time || [];
            const fruitFinderTime = data.imagepuzzlegame_time || [];
            const imagePuzzleTime = data.imagetile_time || [];
            const animalGameTime = data.animalgame_time || [];

            // Updating charts with real data
            createLineChart("mathChart", "Math Adventure", numberGameTime);
            createLineChart("fruitChart", "Fruit Finder", fruitFinderTime);
            createLineChart("imageChart", "Image Puzzle", imagePuzzleTime);
            createLineChart("animalChart", "Find The Animal", animalGameTime);
          })
          .catch((error) => console.error("Error fetching game data:", error));
      });

      // Function to create a Line Chart
      function createLineChart(canvasId, gameTitle, timeData) {
        const ctx = document.getElementById(canvasId).getContext("2d");

        // Create dynamic labels for each game instance (like "Game 1", "Game 2", etc.)
        const gameLabels = timeData.map((_, index) => `Game ${index + 1}`);

        new Chart(ctx, {
          type: "line",
          data: {
            labels: gameLabels, // Dynamic labels for each game instance
            datasets: [
              {
                label: gameTitle + " - Time Taken",
                data: timeData,
                backgroundColor: "rgba(100, 181, 246, 0.2)",
                borderColor: "#42a5f5",
                borderWidth: 2,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Time Taken (seconds)",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Game Instances",
                },
              },
            },
          },
        });
      }
    </script>

    <!-- jQuery CDN (Latest) -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>

    <!-- forum  -->

    <!-- <div class="uploadingwrapper" id="uploadingwrapper">
    <div id="blogUploadContainer">
        <h1 class="closebtn" onclick="closebtn()"><ion-icon name="close-outline"></ion-icon></h1>
        <h2>Upload Post</h2>
        <form id="blogUploadForm" action="/upload/" method="post" enctype="multipart/form-data">
          Django CSRF token
          {% csrf_token %}
          
          Image Upload Field (moved above the heading field)
          <label for="imageUpload">Image Upload:</label>
          <input type="file" id="imageUpload" name="image" accept="image/*" required>
          
          Heading Field
          <label for="heading">Heading:</label>
          <input type="text" id="heading" name="heading" placeholder="Enter blog heading" required>
          
          Description Field
          <label for="description">Description:</label>
          <textarea id="description" name="description" placeholder="Enter blog description" rows="5" required></textarea>
          
          Submit Button
          <button type="submit">Upload Blog</button>
        </form>
      </div>
    
</div> -->

<script>
  function profile(){
    document.querySelector('.profilewrapper').classList.toggle('active')
  }
  function profileclose(){
    document.querySelector('.profilewrapper').classList.remove('active')
  }

  function resetpasswprd(){
    document.getElementById('passed').style.display='block'
  }



  function exchangedata(){
  var user =  document.querySelector('.usernamedata')
   var emaildata= document.querySelector('.emailofthecurrentuser')
   console.log(user)
   var innerdatauser=user.innerText
   var emaildatauser=emaildata.innerText

   
   if (document.querySelector('.editeduser')) return;
   
   
   user.innerHTML= `<input type="text"  class="editeduser"  value="${innerdatauser}" >`
   emaildata.innerHTML=`<input type="email" value='${emaildatauser}' class="editedemail" >`


   document.querySelector('.save').style.display="block"
   document.querySelector('.edit').style.display="none"
   document.querySelector('.cancel').style.display="block"
  }


function updatedata(){

var data = new FormData()

data.append("username", document.querySelector('.editeduser').value)
data.append("email", document.querySelector('.editedemail').value)
data.append("password", document.querySelector('#passed').value)


var newusername=document.querySelector('.editeduser').value
var newemail=document.querySelector('.editedemail').value



data.append("csrfmiddlewaretoken",'{{ csrf_token }}')

$.ajax({

    method:"POST",
    url:'/updatedata/',
    processData:false,
    contentType:false,
    data:data,
    success:function(res){
      if(res.messages){
        alert(res.messages)
      }

      document.querySelector('.usernamedata').innerHTML=newusername
      document.querySelector('.emailofthecurrentuser').innerHTML=newemail


      document.querySelector('.save').style.display="none"
   document.querySelector('.edit').style.display="block"
   document.querySelector('.cancel').style.display="none"
  
        
    }})}


 

</script>
  </body>
</html>
